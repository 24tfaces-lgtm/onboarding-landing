<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ZebraCall ¬∑ –ö—É—Ä—å–µ—Ä—Å–∫–∞—è / –ü–æ—á—Ç–∞ ‚Äî —à–ø–∞—Ä–≥–∞–ª–∫–∞</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net" />
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />
<style>
:root{--brand:#0077ff;--brand2:#00b8ff;--ink:#1a2442;--muted:#667085;--ok:#1a9c5b;--warn:#c23b22;--bg:#f6f8ff;--card:#fff}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
.wrapper{max-width:920px;margin:28px auto;padding:16px}
.card{background:var(--card);border-radius:16px;box-shadow:0 10px 28px rgba(20,30,70,.08);padding:16px;margin:12px 0}
.h1{font-weight:800;font-size:22px;margin:0 0 6px}
.sub{color:var(--muted);font-size:14px;margin:0 0 10px}
.row{display:grid;grid-template-columns:1fr auto auto;gap:8px;margin-top:8px}
input[type=text]{padding:12px 14px;border:1.5px solid #dfe5ff;border-radius:12px;font-size:16px}
.btn{border:0;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer;display:inline-flex;align-items:center;gap:8px}
.btn.primary{background:linear-gradient(135deg,var(--brand),var(--brand2));color:#fff}
.btn.ghost{background:#eef3ff;color:#1a2442}
.btn.icon{min-width:44px;justify-content:center}
.result{margin-top:10px;padding:12px;border-radius:12px;background:#f7f8ff;border:1px dashed #dfe5ff}
.result.ok{background:#f2fbf6;border-color:#c9f1da;color:#0b6c3a}
.result.mail{background:#fffef2;border-color:#ffefb7;color:#6b5200}
.result.fail{background:#fff5f3;border-color:#ffd8d1;color:#7a291d}
.small{font-size:12px;color:var(--muted)}
hr.sep{border:0;border-top:1px solid #e9ecff;margin:14px 0}
.flex{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
kbd{background:#f0f3ff;border:1px solid #dfe5ff;border-bottom-width:2px;border-radius:6px;padding:2px 6px;font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px}
.badge{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid #e3eaff;background:#f5f8ff;color:#1c2d5a;font-size:12px}
pre.code{background:#0b122b;color:#d6e4ff;padding:12px;border-radius:12px;overflow:auto;max-height:260px}
</style>
</head>
<body>
<div class="wrapper">

  <div class="card">
    <div class="h1">–ö—É—Ä—å–µ—Ä—Å–∫–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ / –ü–æ—á—Ç–∞</div>
    <p class="sub">–í–≤–µ–¥–∏ –Ω–∞—Å–µ–ª—ë–Ω–Ω—ã–π –ø—É–Ω–∫—Ç ‚Äî —Å–∏—Å—Ç–µ–º–∞ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç —Å–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏. 
      <span class="badge">–ö–î ‚Äî –∏–∑ —Å–ø–∏—Å–∫–∞ courier-cities.txt</span> 
      <span class="badge">–ü–æ—á—Ç–∞ ‚Äî –∏–∑ Excel/CSV (—Å –∏–Ω–¥–µ–∫—Å–∞–º–∏)</span>
    </p>
    <div class="row">
      <input id="q" type="text" placeholder="–ê–ª–º–∞—Ç—ã, –°–∞–π—Ä–∞–º, –¢–∞–ª–¥—ã–±—É–ª–∞–∫‚Ä¶" list="hints" autocomplete="off"/>
      <datalist id="hints"></datalist>
      <button id="check" class="btn primary" type="button" title="–ü—Ä–æ–≤–µ—Ä–∏—Ç—å">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="#fff" aria-hidden="true"><path d="M10.9 2a9 9 0 1 1-6.36 2.64A9 9 0 0 1 10.9 2zm0 2a7 7 0 1 0 7 7 7.01 7.01 0 0 0-7-7zm3.54 4.46 1.41 1.41-5.3 5.31-3.18-3.18 1.41-1.41 1.77 1.77 3.89-3.9z"/></svg>
        –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
      </button>
      <button id="clear" class="btn icon ghost" type="button" title="–û—á–∏—Å—Ç–∏—Ç—å">‚úï</button>
    </div>
    <div id="out" class="result">–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥/–ø–æ—Å—ë–ª–æ–∫‚Ä¶</div>
    <p class="small">–õ–æ–≥–∏–∫–∞: —Å–Ω–∞—á–∞–ª–∞ –∏—â–µ–º –≤ –±–∞–∑–µ <b>–ö–î</b>. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ ‚Äî –∏—â–µ–º –≤ –±–∞–∑–µ <b>–ü–æ—á—Ç–∞</b>. –ï—Å–ª–∏ –Ω–µ—Ç –Ω–∏–≥–¥–µ ‚Äî –æ—Ñ–æ—Ä–º–ª—è–π –ø–æ—á—Ç—É.</p>
  </div>

  <div class="card">
    <div class="flex">
      <strong>–ë–∞–∑–∞ –ö–î</strong> <span class="small">/ courier-cities.txt –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è</span>
      <button id="loadKD" class="btn ghost" type="button">–ü–æ–¥–≥—Ä—É–∑–∏—Ç—å courier-cities.txt</button>
    </div>
    <hr class="sep"/>
    <details>
      <summary>–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â—É—é –±–∞–∑—É –ö–î</summary>
      <pre id="kdView" class="code"></pre>
    </details>
  </div>

  <div class="card">
    <div class="flex">
      <strong>–ë–∞–∑–∞ –ü–æ—á—Ç—ã</strong> <span class="small">/ –∏–º–ø–æ—Ä—Ç Excel/CSV —Å–æ –≤–∫–ª–∞–¥–∫–∞–º–∏-–≥–æ—Ä–æ–¥–∞–º–∏</span>
      <input id="file" type="file" accept=".xlsx,.xls,.xltx,.csv" />
      <span class="small">–ö–æ–ª–æ–Ω–∫–∏: <kbd>–ù–∞—Å–µ–ª–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç</kbd> –∏ <kbd>–ò–Ω–¥–µ–∫—Å</kbd> (—Ä–µ–≥–∏—Å—Ç—Ä –Ω–µ –≤–∞–∂–µ–Ω). –ï—Å–ª–∏ —É –ª–∏—Å—Ç–∞ –æ–¥–∏–Ω –∏–Ω–¥–µ–∫—Å ‚Äî –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º —Å—Ç—Ä–æ–∫–∞–º —Å –ø—É—Å—Ç—ã–º –∏–Ω–¥–µ–∫—Å–æ–º.</span>
    </div>
    <hr class="sep"/>
    <details>
      <summary>–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â—É—é –±–∞–∑—É –ü–æ—á—Ç—ã</summary>
      <pre id="postView" class="code"></pre>
    </details>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
const $ = s => document.querySelector(s);
const norm = s => (s||"").toLowerCase().replace(/[—ë]/g,"–µ").replace(/[‚Äú‚Äù\"']/g,"").replace(/\s+/g," ").trim();

const out = $("#out");
const input = $("#q");
const hints = $("#hints");
const kdView = $("#kdView");
const postView = $("#postView");

let kdRaw = [];
let kdSet = new Set;

async function loadKDfromTxt(){
  try{
    const base = new URL(window.location.href);
    base.hash = ""; base.search = "";
    base.pathname = base.pathname.replace(/[^\/]+$/,"courier-cities.txt");
    const resp = await fetch(base.toString(), {cache:"no-store"});
    if(!resp.ok) throw 0;
    const text = await resp.text();
    kdRaw = text.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
    kdSet = new Set(kdRaw.map(norm));
    kdView.textContent = kdRaw.join(", ");
    rebuildHints();
    console.log("–ö–î –∑–∞–≥—Ä—É–∂–µ–Ω–æ:", kdRaw.length);
  }catch(e){
    alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å courier-cities.txt. –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ñ–∞–π–ª –ª–µ–∂–∏—Ç —Ä—è–¥–æ–º —Å HTML.");
  }
}
$("#loadKD").addEventListener("click", loadKDfromTxt);

let postMap = new Map(); // key: normalized, val: {label,index,city}

function addPostEntry(npLabel, index, sheetName){
  const key = norm(npLabel);
  if(!key) return;
  const val = { label: String(npLabel||"").trim(), index: String(index||"").trim(), city: sheetName||"" };
  postMap.set(key, val);
}

function rebuildHints(){
  hints.innerHTML = "";
  const frag = document.createDocumentFragment();
  const combined = new Set();
  kdRaw.slice(0,500).forEach(s => combined.add(s));
  Array.from(postMap.values()).slice(0,500).forEach(o => combined.add(o.label + (o.index ? ` (–∏–Ω–¥. ${o.index})` : "")));
  Array.from(combined).forEach(v=>{
    const opt = document.createElement("option");
    opt.value = v;
    frag.appendChild(opt);
  });
  hints.appendChild(frag);
}

function renderPostPreview(){
  const arr = Array.from(postMap.values()).map(o => `${o.label} ‚Äî ${o.index}${o.city? " ("+o.city+")":""}`);
  postView.textContent = arr.join(", ");
}

$("#file").addEventListener("change", async (e) => {
  const f = e.target.files[0]; if(!f) return;
  try{
    const buf = await f.arrayBuffer();
    const wb = XLSX.read(buf, {type:"array"});
    postMap = new Map();

    wb.SheetNames.forEach(sheetName => {
      const ws = wb.Sheets[sheetName];
      if(!ws) return;
      const json = XLSX.utils.sheet_to_json(ws, {defval:""});
      if(!json.length) return;

      const cols = Object.keys(json[0]).reduce((acc, k) => { acc[k.toLowerCase()] = k; return acc; }, {});
      const npKey = Object.keys(cols).find(k => k.includes("–Ω–∞—Å–µ–ª") || k.includes("–ø—É–Ω–∫—Ç")) || Object.keys(cols).find(k=>k.includes("–Ω–∞—Å"));
      const idxKey = Object.keys(cols).find(k => k.includes("–∏–Ω–¥–µ–∫—Å"));
      const npCol = npKey ? cols[npKey] : null;
      const idxCol = idxKey ? cols[idxKey] : null;
      if(!npCol){ return; }

      let singleIndex = "";
      if(idxCol){
        const uniq = new Set(json.map(r => String(r[idxCol]||"").trim()).filter(v=>v));
        if(uniq.size === 1){ singleIndex = Array.from(uniq)[0]; }
      }

      json.forEach(row => {
        const np = String(row[npCol]||"").trim();
        if(!np) return;
        let idx = idxCol ? String(row[idxCol]||"").trim() : "";
        if(!idx && singleIndex) idx = singleIndex;
        addPostEntry(np, idx, sheetName);
      });
    });

    renderPostPreview();
    rebuildHints();
    console.log("–ü–æ—á—Ç–æ–≤—ã—Ö –ø—É–Ω–∫—Ç–æ–≤:", postMap.size);
  }catch(err){
    console.error(err);
    alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª. –£–±–µ–¥–∏—Å—å, —á—Ç–æ —ç—Ç–æ .xlsx/.xls/.xltx –∏–ª–∏ .csv —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏ ¬´–ù–∞—Å–µ–ª—ë–Ω–Ω—ã–π –ø—É–Ω–∫—Ç¬ª –∏ ¬´–ò–Ω–¥–µ–∫—Å¬ª.");
  }
});

function check(query){
  const qn = norm(query);
  if(!qn){ showMuted(); return; }

  if(kdSet.has(qn)){
    out.className = "result ok";
    out.textContent = `‚úÖ –ö—É—Ä—å–µ—Ä—Å–∫–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞: ${query}`;
    return;
  }

  const exact = postMap.get(qn);
  if(exact){
    out.className = "result mail";
    out.textContent = `üì¨ –ü–æ—á—Ç–æ–≤–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞. –ò–Ω–¥–µ–∫—Å: ${exact.index || "‚Äî"}${exact.city? " ¬∑ " + exact.city:""}`;
    return;
  }

  const found = Array.from(postMap.entries()).find(([k,v]) => k.includes(qn));
  if(found){
    const v = found[1];
    out.className = "result mail";
    out.textContent = `üì¨ –ü–æ—á—Ç–æ–≤–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞. –ò–Ω–¥–µ–∫—Å: ${v.index || "‚Äî"}${v.city? " ¬∑ " + v.city:""}`;
    return;
  }

  out.className = "result fail";
  out.textContent = "‚úâÔ∏è –ù–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –±–∞–∑–∞—Ö ‚Äî –æ—Ñ–æ—Ä–º–ª—è–π –ü–û–ß–¢–£.";
}

function showMuted(){
  out.className = "result";
  out.textContent = "–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥/–ø–æ—Å—ë–ª–æ–∫‚Ä¶";
}

$("#check").addEventListener("click", () => check(input.value));
$("#clear").addEventListener("click", () => { input.value=""; showMuted(); input.focus(); });
input.addEventListener("input", e => check(e.target.value));
</script>
</body>
</html>
